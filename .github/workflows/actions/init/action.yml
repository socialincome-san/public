name: Initialize Repository
description: Set up Node.js, plus installs firebase-tools and dependencies

inputs:
  installDependencies:
    description: If dependencies will be installed or not
    required: false
    default: "true"
  project:
    description: The Firebase project to deploy to (social-income-staging|social-income-prod)
    required: true
    default: social-income-staging

runs:
  using: composite
  steps:
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: 18
        cache: npm
        cache-dependency-path: package-lock.json

    - name: Install and set up firebase-tools
      shell: bash
      run: |
        npm -g install firebase-tools@11.29.1 && \
        firebase setup:emulators:firestore && \
        firebase setup:emulators:storage && \
        firebase setup:emulators:ui

    - name: Install dependencies
      if: inputs.installDependencies == 'true'
      shell: bash
      run: npm ci

    - name: Create staging credentials JSON file
      if: inputs.project == 'social-income-staging'
      uses: jsdaniell/create-json@v1.2.2
      with:
        name: credentials.json
        json: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_SOCIAL_INCOME_STAGING }}

    - name: Create production credentials JSON file
      if: inputs.project == 'social-income-prod'
      uses: jsdaniell/create-json@v1.2.2
      with:
        name: credentials.json
        json: ${{ secrets.FIREBASE_SERVICE_ACCOUNT_SOCIAL_INCOME_PROD }}
